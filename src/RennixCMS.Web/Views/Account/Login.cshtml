<!DOCTYPE html>
<html>
    <head>
        <title>欢迎登录</title>
        <!-- 引入样式 -->
        <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
         <!-- import Vue before Element -->
        <script src="https://unpkg.com/vue/dist/vue.js"></script>
        <script src="https://cdn.bootcss.com/vue-resource/1.5.1/vue-resource.js"></script>
        <!-- import JavaScript -->
        <script src="https://unpkg.com/element-ui/lib/index.js"></script>

        <style>
            *{
                padding: 0;
                margin: 0;
                box-sizing: border-box;
            }
            body{
                background: url(/images/login_bg.png);
            }
            #app{
                display: flex;
                width:100%;
                height: 100vh;
                flex-direction: row;
                justify-content: center;
                align-items: center;
            }
            .form-wrapper{
                color:#ccc;
                padding: 50px 50px 30px 0px;
                height: 300px;
                min-width:18%;
                border: 2px solid #ccc;
                border-radius: 10px;
                background: #fff;
            }
            #btn-login{
                width:86%;
            }
        </style>
    </head>
    <body>
    <div id="app">
        <div class="form-wrapper">

            <el-form :model="form" :rules="rules" ref="ruleForm" label-position="right" label-width="80px">

                <el-form-item label="账号" prop="account">
                    <el-input v-model="form.account" placeholder="请输入与用户名/手机号/邮箱" clearable></el-input>
                </el-form-item>

                <el-form-item label="密码" prop="password">
                    <el-input type="password" v-model="form.password" placeholder="请输入密码" clearable></el-input>
                </el-form-item>

                <el-form-item>
                    <el-checkbox v-model="form.rememerMe">记住我</el-checkbox>
                    <el-button id="btn-login" @@click="submitForm('ruleForm')" type="primary" :loading="isLogining">登&nbsp;录</el-button>
                </el-form-item>

            </el-form>
        </div>
    </div>
    </body>
   <script src="/js/site.js"></script>
    <script>
        new Vue({
        el: '#app',
        data: function() {
            return { 
                form:{
                    account:'',
                    password:'',
                    rememerMe:true,
                    returnUrl:cms.util.queryString.getByName('returnUrl')
                },
                // 是否正在登录中 用于展示按钮登录动画
                isLogining:false,
                rules:{
                    account: [
                        { required: true, message: '请输入账号', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: '请输入密码', trigger: 'blur' }
                    ]
                }
            };
        },
        methods:{
            submitForm(formName) {
            this.isLogining = true;
            var me = this;
            this.$refs[formName].validate((valid) => {
                if (valid) {
                    me.$http.post(cms.urls.login,me.form)
                    .then(function(res){
                        if(res.body.success)
                        {
                            this.$message({
                                message: '登录成功',
                                type: 'success'
                            });
                            location.href = res.body.data.redirectToUrl || '/';
                        }
                    })
                    .catch(function(err){
                        this.$message({
                            message: err.body.error_message,
                            type: 'error'
                        });
                        me.form.password = '';
                    })
                }
                this.isLogining = false;
            });
        }
        }});
    </script>
</html>